salsa20_encrypt_decrypt_plugin
==============================

```
ì‚´ì‚¬ì¶¤ì„ ì¶¥ì‹œë‹¤!
                                     @@          
                                    @@@@          
             @@@@                   #@@@          
            :@@@@:                  +@@#          
           @@@@@@#                   @@.          
           @@@@@%=       #%*=    .@@@@@@@@%       
         #*@@@@@.       @--@@    @@@@@@@@@@+      
         -@@%@@@@%*@@@#     .@@@@@.@@@@@@*%@@     
   =    #@@.=@@@@=   .       %@@@  @@@@@@= @@.    
    #  %@*   @@@@             @@   @@@@@@-@@#     
   +@@@-     *@@@                  @@@@@@@@*      
             .@@@                  @@@@@@@:       
            -@@@@@@@@              @@@@@@@        
            @@@@@@@@@=             @@@@@@@:       
           +@@@@@@@+@.             .@@@@@@*       
           @@@#@@@@                 @@@@@@*       
           @@@  -@#                 %@@@@@*       
           @@:  -@:                 .@@@@@+       
          =@@   @@                 .@@@@@         
          *@@  .@%                .@@@@@@:        
          %@#  =@:                *@@@+@@@        
          @@   @-                 -@@+ @@@@       
          @#   @                   -@* -@@@.      
         .@   %-                    %@. @@@=      
         -@  :@                      #- %@#       
         #@. *@                         :@@       
         @:- @.                         -@#       
        =@                              -@:       
                                         :        
```

ì´ í”ŒëŸ¬ê·¸ì¸ì€ mariadb ì—ì„œ [Salsa20](https://en.wikipedia.org/wiki/Salsa20) ì•”í˜¸í™”, ë³µí˜¸í™”ë¥¼ ìœ„í•´ ë§Œë“¤ì–´ì¡ŒìŠµë‹ˆë‹¤.

ì‹¤ì œ í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ê¸° ì „ ë°˜ë“œì‹œ ì ì ˆí•œ í…ŒìŠ¤íŠ¸ í›„ í™˜ê²½ì— ë§ì¶”ì–´ ìˆ˜ì •í•´ ì‚¬ìš©í•˜ì„¸ìš”.


Disclaimer
----------

ì´ ì½”ë“œëŠ” ì‚¬ìš©ìì˜ í™˜ê²½ì— ë”°ë¼ ë°ì´í„° ì†ì‹¤ê³¼ ê°™ì€ ìœ„í—˜ì„ ì´ˆë˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì‘ì„±ìëŠ” ì´ ì½”ë“œì˜ ì •í™•ì„±, ì™„ì „ì„±, ì‹ ë¢°ì„± ë˜ëŠ” íŠ¹ì • ëª©ì ì— ëŒ€í•œ ì í•©ì„±ì— ëŒ€í•´ ëª…ì‹œì  ë˜ëŠ” ë¬µì‹œì ì¸ ì–´ë– í•œ ë³´ì¦ë„ ì—†ìœ¼ë©° ë©´ì±…ì…ë‹ˆë‹¤. 

ì‚¬ìš©ìëŠ” ì´ ì½”ë“œê°€ ìì‹ ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì— ì í•©í•˜ê³  ì•ˆì „í•œì§€ í™•ì¸í•  ì±…ì„ì´ ì „ì ìœ¼ë¡œ ë³¸ì¸ì—ê²Œ ìˆìŒì„ ì¸ì •í•©ë‹ˆë‹¤.

ê·¸ë ‡ì§€ ì•Šì„ ê²½ìš° ì´ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì§€ ë§ˆì‹­ì‹œì˜¤.


Required libraries
------------------

ë¹Œë“œë¥¼ ìœ„í•´ libsodium, libmysqlclient ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.

- Ubuntu/Debian
  
  sudo apt-get update
  sudo apt-get install libmysqlclient-dev libsodium-dev

- CentOS/RHEL
  
  sudo yum install mysql-devel libsodium-devel


How to build
------------

make


How to install
--------------

1. ë¹Œë“œëœ `salsa20_encrypt_decrypt_plugin.so` íŒŒì¼ì„ mariadb í”ŒëŸ¬ê·¸ì¸ ë””ë ‰í† ë¦¬ì— ë³µì‚¬í•©ë‹ˆë‹¤.
   
   cp ./salsa20_encrypt_decrypt_plugin.so REPLACE-YOUR-SHARE-LIBRARY-PATH/mysql/plugin/

2. í•¨ìˆ˜ ìƒì„± ì¿¼ë¦¬ë¡œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ë§¤í•‘í•©ë‹ˆë‹¤.

  CREATE FUNCTION SALSA_ENCRYPT RETURNS STRING SONAME 'salsa20_encrypt_decrypt_plugin.so';
  CREATE FUNCTION SALSA_DECRYPT RETURNS STRING SONAME 'salsa20_encrypt_decrypt_plugin.so';

* Where is the mariadb plugin directory
  
  `SHOW VARIABLES LIKE 'plugin_dir';` ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì²˜ëŸ¼ í”ŒëŸ¬ê·¸ì¸ ê²½ë¡œê°€ ì¶œë ¥ë©ë‹ˆë‹¤. 
 
  +---------------+----------------------------------+
  | Variable_name | Value                            |
  +---------------+----------------------------------+
  | plugin_dir    | /usr/share/lib64/mysql/plugin/   |
  +---------------+----------------------------------+


How to use
----------

* ë°˜ë“œì‹œ ì•”í˜¸í™”í‚¤ëŠ” 256ë¹„íŠ¸ì˜ ê¸¸ì´ë¡œ ì§€ì •í•˜ì„¸ìš”.(ê·¸ëŸ¬ë‹ˆê¹Œ 32ê¸€ìì˜ ASCII ë¯„ì, 256/8)

ì•„ë˜ì™€ ê°™ì´ ë”°ë¼í•´ë³¼ ìˆ˜ ìˆìˆ©ë‹ˆë‹¤.

# 1. ë¹Œë“œ.
$ make clean; make
  rm -f *.o salsa20_encrypt_decrypt_plugin.so
  gcc -fPIC -Wall -I/usr/include/mysql -c salsa20_encrypt_decrypt_plugin.c
  gcc -shared -o salsa20_encrypt_decrypt_plugin.so salsa20_encrypt_decrypt_plugin.o -lsodium -lmysqlclient


# 2. ë¹Œë“œí•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë³µì‚¬.
$ cp salsa20_encrypt_decrypt_plugin.so [YOUR_LIBRARY_DIR]/mysql/plugin/


# 3. ë§ˆë¦¬ì•„DB ì ‘ì†
$ mysql -ulocaluser -p


# 4. ì´ˆê¸°í™”
MariaDB > DROP FUNCTION IF EXISTS SALSA_DECRYPT;
MariaDB > DROP FUNCTION IF EXISTS SALSA_ENCRYPT;
MariaDB > CREATE FUNCTION SALSA_DECRYPT RETURNS STRING SONAME 'salsa20_encrypt_decrypt_plugin.so';
MariaDB > CREATE FUNCTION SALSA_ENCRYPT RETURNS STRING SONAME "salsa20_encrypt_decrypt_plugin.so";


# 5. í…ŒìŠ¤íŠ¸ìš© DB, Table ìƒì„±
MariaDB > DROP DATABASE IF EXISTS db_salsa_salsa_test;
MariaDB > CREATE DATABASE db_salsa_salsa_test;
MariaDB > USE db_salsa_salsa_test;

MariaDB > DROP TABLE IF EXISTS tb_mixed_vars;
MariaDB > CREATE TABLE tb_mixed_vars (
              cbin LONGTEXT,
              cb64 LONGTEXT,
              chex LONGTEXT,
              cblb BLOB,
              cblbd BLOB
          ) ENGINE=MyISAM;


# 6. Insert encrypted text.
MariaDB > INSERT INTO tb_mixed_vars VALUES(
          SALSA_ENCRYPT("honolulululululululululululululu", "Just", "binary") ,
          SALSA_ENCRYPT("honolulululululululululululululu", "getting", "base64"),
          SALSA_ENCRYPT("honolulululululululululululululu", "older", "hex") ,
          SALSA_ENCRYPT("honolulululululululululululululu", "and smoking", "blob"),
          SALSA_ENCRYPT("honolulululululululululululululu", "more...")
        );

# 7. Select and decrypt text.
MariaDB > SELECT 
          SALSA_DECRYPT("honolulululululululululululululu", (cbin AS CHAR), "binary") AS "cbin",
          SALSA_DECRYPT("honolulululululululululululululu", (cb64 AS CHAR), "base64") AS "cb64",
          SALSA_DECRYPT("honolulululululululululululululu", (chex AS CHAR), "hex") AS "chex",
          SALSA_DECRYPT("honolulululululululululululululu", cblb, "blob") AS "cblb",
          SALSA_DECRYPT("honolulululululululululululululu", cblbd, "blob") AS "cblbd"
        FROM tb_mixed_vars;


# 8. ì´ê²Œ ë‹¤ì˜ˆìš”. ğŸ¤·â€â™‚ï¸

MariaDB > DROP DATABASE IF EXISTS db_salsa_salsa_test;
MariaDB > DROP TABLE IF EXISTS tb_mixed_vars;
MariaDB > quit


TODO
----

[ ] ìºìŠ¤íŒ… í¸ì˜ì„± ì¶”ê°€. ì•„ì§ mariadbì†ŒìŠ¤ë¥¼ ê¹Œë³´ì§€ ì•Šì•„ì„œ ë‘ë µìŠµë‹ˆë‹¤
[ ] ì½”ë“œ ì´ˆë¯¸ë‹ˆ ê²½ëŸ‰í™”
[ ] make install ì¶”ê°€
[ ] test shell ì‘ì„±

License
-------

Unlicense. 

I love unlicense.